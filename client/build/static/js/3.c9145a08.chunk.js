(this["webpackJsonphello-react"]=this["webpackJsonphello-react"]||[]).push([[3],{133:function(e,t,a){"use strict";a.r(t);var s=a(7),r=a.n(s),c=a(9),n=a(2),i=a(6),o=a(14),l=a.n(o),d=a(38),u=a(1),b=a(15),m=a(123),j=a(124),h=a(81),p=a(128),g=a(126),O=a(121),x=a(0);t.default=function(e){var t=Object(u.useContext)(b.a),a=t.user,s=t.dispatch,o=Object(u.useState)({touched:!1,isValid:!1,msg:""}),f=Object(i.a)(o,2),v=f[0],y=f[1],w=Object(u.useState)({touched:!1,isValid:!1,msg:""}),k=Object(i.a)(w,2),V=k[0],N=k[1],T=Object(u.useState)(null),S=Object(i.a)(T,2),C=S[0],P=S[1],L=Object(u.useState)(!1),E=Object(i.a)(L,2),G=E[0],B=E[1],F=Object(u.useState)(!1),I=Object(i.a)(F,2),q=I[0],A=I[1],D=Object(u.useState)({isError:!1,msg:""}),J=Object(i.a)(D,2),U=J[0],R=J[1],_=function(){var e=Object(c.a)(r.a.mark((function e(){var t;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.post("/users/refresh-token",{token:a.refreshToken});case 3:return t=e.sent,s({type:"LOGIN_SUCCESS",payload:Object(n.a)(Object(n.a)({},a),{},{accessToken:t.data.accessToken})}),e.abrupt("return",t.data);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),z=l.a.create();z.interceptors.request.use(function(){var e=Object(c.a)(r.a.mark((function e(t){var s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new Date,!(1e3*Object(d.a)(a.accessToken).exp<s.getTime())){e.next=7;break}return e.next=5,_();case 5:c=e.sent,t.headers["auth-token"]=c.accessToken;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}));var H=function(){var e=Object(c.a)(r.a.mark((function e(t){var s,c;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),e.prev=1,!(v.isValid&&V.isValid&&C)){e.next=14;break}return(s=new FormData).append("title",t.target.title.value),s.append("body",t.target.body.value),s.append("image",C),console.log(t.target.title.value,t.target.body.value,C),B(!0),e.next=11,z({method:"post",url:"/posts",data:s,headers:{"auth-token":a.accessToken,"Content-Type":"multipart/form-data"}});case 11:c=e.sent,t.target.reset(),c.data&&(window.location.replace("/app/posts/".concat(c.data._id)),B(!1),A(!0));case 14:e.next=22;break;case 16:e.prev=16,e.t0=e.catch(1),console.log(e.t0),B(!1),A(!1),400===e.t0.response.status?R({isError:!0,msg:"Invalid inputs"}):R({isError:!0,msg:"Somthing went wrong!"});case 22:case"end":return e.stop()}}),e,null,[[1,16]])})));return function(t){return e.apply(this,arguments)}}();return Object(x.jsx)(m.a,{children:Object(x.jsx)(j.a,{children:Object(x.jsxs)(h.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[Object(x.jsx)("h2",{className:" text-center h4 m-3 text-secondary",children:"Add Post"}),Object(x.jsxs)(p.a,{onSubmit:H,children:[Object(x.jsxs)(p.a.Group,{className:"mb-3",children:[Object(x.jsx)(p.a.Label,{children:"Post title"}),Object(x.jsx)(p.a.Control,{type:"text",placeholder:"Enter Title",name:"title",className:function(){if(v.touched)return v.isValid?"border border-success":"border border-danger"}(),onBlur:function(e){var t=e.target.value.trim(),a=Object(n.a)({},v);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Title is required."):t.length<3?(a.isValid=!1,a.msg="Title must be more than 2 characters."):t.length>255?(a.isValid=!1,a.msg="Title must be less than 255 characters."):(a.isValid=!0,a.msg=""),y(Object(n.a)({},a))},autoFocus:!0}),v.msg&&Object(x.jsx)("small",{className:"text-danger p-1",children:v.msg})]}),Object(x.jsxs)(p.a.Group,{className:"mb-3",controlId:"exampleForm.ControlTextarea1",children:[Object(x.jsx)(p.a.Label,{children:"Post body"}),Object(x.jsx)(p.a.Control,{as:"textarea",rows:3,name:"body",className:function(){if(V.touched)return V.isValid?"border border-success":"border border-danger"}(),onChange:function(e){var t=e.target.value.trim(),a=Object(n.a)({},V);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Body is required."):t.length<5?(a.isValid=!1,a.msg="Body must be more than 4 characters."):t.length>1e4?(a.isValid=!1,a.msg="Body must be less than 10000 characters."):(a.isValid=!0,a.msg=""),N(Object(n.a)({},a))}}),V.msg&&Object(x.jsx)("small",{className:"text-danger p-1",children:V.msg})]}),Object(x.jsxs)(p.a.Group,{controlId:"formFile",className:"mb-3",children:[Object(x.jsx)(p.a.Label,{children:"Post image"}),Object(x.jsx)("div",{className:"d-flex my-2 justify-content-center",children:Object(x.jsx)(h.a,{xs:6,md:4,children:C&&Object(x.jsx)(g.a,{src:URL.createObjectURL(C),thumbnail:!0})})}),Object(x.jsx)(p.a.Control,{type:"file",name:"image",accept:"image/png, image/jpeg, image/jpg, image/JPG, image/svg, image/webp",onChange:function(e){return P(e.target.files[0])}})]}),Object(x.jsx)(O.a,{variant:"primary",type:"submit",className:"w-100",disabled:!v.isValid||!V.isValid||!C,children:G?"Loading ...":"Add New Post"})]}),U.isError&&Object(x.jsx)("div",{className:"alert alert-danger text-center my-2",children:U.msg}),q&&Object(x.jsx)("div",{className:"alert alert-success text-center my-2",children:"Post Added Successfully"})]})})})}}}]);
//# sourceMappingURL=3.c9145a08.chunk.js.map