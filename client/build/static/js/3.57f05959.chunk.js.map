{"version":3,"sources":["components/blog/AddPost.js"],"names":["AddPost","props","useContext","Context","user","dispatch","useState","image","setImage","isLoading","setisLoading","addSuccess","setaddSuccess","touched","isValid","msg","titleValid","setTitleValid","bodyValid","setBodyValid","isError","error","setError","refreshToken","a","axios","post","token","res","type","payload","accessToken","data","console","log","axiosJWT","create","interceptors","request","use","config","currentDate","Date","jwt_decode","exp","getTime","headers","err","Promise","reject","addPostHandler","e","preventDefault","formData","FormData","append","target","title","value","body","method","url","window","location","replace","_id","reset","response","status","md","lg","className","onSubmit","Group","Label","Control","placeholder","name","titleStyle","onBlur","val","trim","valids","length","autoFocus","controlId","as","rows","bodyStyle","onChange","xs","src","URL","createObjectURL","thumbnail","accept","files","variant","disabled"],"mappings":"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","file":"static/js/3.57f05959.chunk.js","sourcesContent":["import axios from \"axios\";\nimport jwt_decode from \"jwt-decode\";\nimport { useState, useContext } from \"react\";\nimport { Context } from \"../../context/Context\";\nimport { Button, Container, Form, Row, Col, Image } from \"react-bootstrap\";\n\nconst AddPost = (props) => {\n  const { user, dispatch } = useContext(Context);\n  const [image, setImage] = useState(null);\n  const [isLoading, setisLoading] = useState(false);\n  const [addSuccess, setaddSuccess] = useState(false);\n\n  const [titleValid, setTitleValid] = useState({\n    touched: false,\n    isValid: false,\n    msg: \"\",\n  });\n\n  const [bodyValid, setBodyValid] = useState({\n    touched: false,\n    isValid: false,\n    msg: \"\",\n  });\n\n  const [error, setError] = useState({\n    isError: false,\n    msg: \"\",\n  });\n\n  const checkTitleValidation = (e) => {\n    let val = e.target.value.trim();\n    let valids = { ...titleValid };\n    valids.touched = true;\n\n    if (val.length <= 0) {\n      valids.isValid = false;\n      valids.msg = \"Title is required.\";\n    } else if (val.length < 3) {\n      valids.isValid = false;\n      valids.msg = \"Title must be more than 2 characters.\";\n    } else if (val.length > 255) {\n      valids.isValid = false;\n      valids.msg = \"Title must be less than 255 characters.\";\n    } else {\n      valids.isValid = true;\n      valids.msg = \"\";\n    }\n    setTitleValid({ ...valids });\n  };\n\n  const checkBodyValidation = (e) => {\n    let val = e.target.value.trim();\n    let valids = { ...bodyValid };\n    valids.touched = true;\n\n    if (val.length <= 0) {\n      valids.isValid = false;\n      valids.msg = \"Body is required.\";\n    } else if (val.length < 5) {\n      valids.isValid = false;\n      valids.msg = \"Body must be more than 4 characters.\";\n    } else if (val.length > 10000) {\n      valids.isValid = false;\n      valids.msg = \"Body must be less than 10000 characters.\";\n    } else {\n      valids.isValid = true;\n      valids.msg = \"\";\n    }\n    setBodyValid({ ...valids });\n  };\n\n  const titleStyle = () => {\n    if (titleValid.touched) {\n      if (titleValid.isValid) {\n        return \"border border-success\";\n      } else return \"border border-danger\";\n    }\n  };\n\n  const bodyStyle = () => {\n    if (bodyValid.touched) {\n      if (bodyValid.isValid) {\n        return \"border border-success\";\n      } else return \"border border-danger\";\n    }\n  };\n\n  const refreshToken = async () => {\n    try {\n      const res = await axios.post(\"/api/v1/users/refresh-token\", {\n        token: user.refreshToken,\n      });\n      dispatch({\n        type: \"LOGIN_SUCCESS\",\n        payload: { ...user, accessToken: res.data.accessToken },\n      });\n      return res.data;\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const axiosJWT = axios.create();\n  //This will run before axios request to refresh token\n  axiosJWT.interceptors.request.use(\n    async (config) => {\n      let currentDate = new Date();\n      const decodedToken = jwt_decode(user.accessToken);\n      if (decodedToken.exp * 1000 < currentDate.getTime()) {\n        const data = await refreshToken();\n        config.headers[\"auth-token\"] = data.accessToken;\n      }\n      return config;\n    },\n    (err) => {\n      return Promise.reject(err);\n    }\n  );\n\n  const addPostHandler = async (e) => {\n    e.preventDefault();\n    try {\n      if (titleValid.isValid && bodyValid.isValid && image) {\n        let formData = new FormData();\n        formData.append(\"title\", e.target.title.value);\n        formData.append(\"body\", e.target.body.value);\n        formData.append(\"image\", image);\n\n        setisLoading(true);\n\n        let res = await axiosJWT({\n          method: \"post\",\n          url: \"/api/v1/posts\",\n          data: formData,\n          headers: {\n            \"auth-token\": user.accessToken,\n            \"Content-Type\": \"multipart/form-data\",\n          },\n        });\n\n        if (res.data) {\n          setisLoading(false);\n          setaddSuccess(true);\n          window.location.replace(`/app/posts/${res.data._id}`);\n          e.target.reset();\n        }\n      }\n    } catch (err) {\n      setisLoading(false);\n      setaddSuccess(false);\n      if (err.response.status === 400) {\n        setError({ isError: true, msg: \"Invalid inputs\" });\n      } else {\n        setError({ isError: true, msg: \"Somthing went wrong!\" });\n      }\n    }\n  };\n\n  return (\n    <Container>\n      <Row>\n        <Col md={6} lg={4} className=\" mx-auto bg-light p-4 my-4 shadow-sm\">\n          <h2 className=\" text-center h4 m-3 text-secondary\">Add Post</h2>\n          <Form onSubmit={addPostHandler}>\n            <Form.Group className=\"mb-3\">\n              <Form.Label>Post title</Form.Label>\n              <Form.Control\n                type=\"text\"\n                placeholder=\"Enter Title\"\n                name=\"title\"\n                className={titleStyle()}\n                onBlur={checkTitleValidation}\n                autoFocus\n              />\n              {titleValid.msg && (\n                <small className=\"text-danger p-1\">{titleValid.msg}</small>\n              )}\n            </Form.Group>\n\n            <Form.Group\n              className=\"mb-3\"\n              controlId=\"exampleForm.ControlTextarea1\"\n            >\n              <Form.Label>Post body</Form.Label>\n              <Form.Control\n                as=\"textarea\"\n                rows={3}\n                name=\"body\"\n                className={bodyStyle()}\n                onChange={checkBodyValidation}\n              />\n              {bodyValid.msg && (\n                <small className=\"text-danger p-1\">{bodyValid.msg}</small>\n              )}\n            </Form.Group>\n            <Form.Group controlId=\"formFile\" className=\"mb-3\">\n              <Form.Label>Post image</Form.Label>\n              <div className=\"d-flex my-2 justify-content-center\">\n                <Col xs={6} md={4}>\n                  {image && (\n                    <Image src={URL.createObjectURL(image)} thumbnail />\n                  )}\n                </Col>\n              </div>\n              <Form.Control\n                type=\"file\"\n                name=\"image\"\n                accept=\"image/png, image/jpeg, image/jpg, image/JPG, image/svg, image/webp\"\n                onChange={(e) => setImage(e.target.files[0])}\n              />\n            </Form.Group>\n            <Button\n              variant=\"primary\"\n              type=\"submit\"\n              className=\"w-100\"\n              disabled={!titleValid.isValid || !bodyValid.isValid || !image}\n            >\n              {isLoading ? \"Loading ...\" : \"Add New Post\"}\n            </Button>\n          </Form>\n          {error.isError && (\n            <div className=\"alert alert-danger text-center my-2\">\n              {error.msg}\n            </div>\n          )}\n          {addSuccess && (\n            <div className=\"alert alert-success text-center my-2\">\n              Post Added Successfully\n            </div>\n          )}\n        </Col>\n      </Row>\n    </Container>\n  );\n};\n\nexport default AddPost;\n"],"sourceRoot":""}