(this["webpackJsonphello-react"]=this["webpackJsonphello-react"]||[]).push([[0],{118:function(e,t,a){"use strict";a.r(t);var s=a(1),r=a.n(s),c=a(24),n=a.n(c),i=(a(87),a(123)),o=a(5),l=function(e,t){switch(t.type){case"LOGIN_START":return{user:null,isFetching:!0,error:!1};case"LOGIN_SUCCESS":return{user:t.payload,isFetching:!1,error:!1};case"LOGIN_FAILURE":return{user:null,isFetching:!1,error:!0};case"LOGOUT":return{user:null,isFetching:!1,error:!1};default:return e}},d=a(0),u={user:JSON.parse(localStorage.getItem("user"))||null,isFetching:!1,error:!1},j=Object(s.createContext)(u),b=function(e){var t=e.children,a=Object(s.useReducer)(l,u),r=Object(o.a)(a,2),c=r[0],n=r[1];return Object(s.useEffect)((function(){localStorage.setItem("user",JSON.stringify(c.user))}),[c.user]),Object(d.jsx)(j.Provider,{value:{user:c.user,isFetching:c.isFetching,error:c.error,dispatch:n},children:t})},m=a(14),h=a(10),p=a(7),O=a.n(p),x=a(8),g=a(2),f=a(11),v=a.n(f),y=a(120),w=a(121),N=a(78),k=a(127),S=a(122),V=function(){var e=Object(s.useContext)(j),t=e.dispatch,a=e.isFetching,r=e.error,c=Object(s.useState)({touched:!1,isValid:!1,msg:""}),n=Object(o.a)(c,2),i=n[0],l=n[1],u=Object(s.useState)({touched:!1,isValid:!1,msg:""}),b=Object(o.a)(u,2),m=b[0],h=b[1],p=function(){var e=Object(x.a)(O.a.mark((function e(a){var s,r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),t({type:"LOGIN_START"}),s=a.target.email.value,r=a.target.password.value,e.prev=3,!i.isValid||!m.isValid){e.next=10;break}return e.next=7,v.a.post("/api/v1/users/login",{email:s,password:r});case 7:c=e.sent,t({type:"LOGIN_SUCCESS",payload:c.data}),window.location.replace("/app");case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),t({type:"LOGIN_FAILURE"}),console.log(e.t0);case 16:case"end":return e.stop()}}),e,null,[[3,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsx)(y.a,{children:Object(d.jsx)(w.a,{children:Object(d.jsxs)(N.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[Object(d.jsx)("h2",{className:" text-center h4 m-3 text-secondary",children:"Login"}),Object(d.jsxs)(k.a,{onSubmit:p,children:[Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"exampleForm.ControlInput1",children:[Object(d.jsx)(k.a.Label,{children:"Email address"}),Object(d.jsx)(k.a.Control,{type:"email",placeholder:"Enter email",name:"email",onBlur:function(e){var t=e.target.value.trim(),a=Object(g.a)({},i);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Email is required."):/\S+@\S+\.\S+/.test(t)?t.length>100?(a.isValid=!1,a.msg="Email must be less than 100 characters."):(a.isValid=!0,a.msg=""):(a.isValid=!1,a.msg="Email is not valid"),l(Object(g.a)({},a))},className:function(){if(i.touched)return i.isValid?"border border-success":"border border-danger"}()}),i.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:i.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"formPlaintextPassword",children:[Object(d.jsx)(k.a.Label,{children:"Password"}),Object(d.jsx)(k.a.Control,{type:"password",placeholder:"Enter password",name:"password",onKeyUp:function(e){var t=e.target.value.trim(),a=Object(g.a)({},m);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Password is required."):t.length>255?(a.isValid=!1,a.msg="Password must be less than 255 characters."):(a.isValid=!0,a.msg=""),h(Object(g.a)({},a))},className:function(){if(m.touched)return m.isValid?"border border-success":"border border-danger"}()}),m.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:m.msg})]}),Object(d.jsx)(S.a,{variant:"primary",type:"submit",className:"w-100",disabled:!i.isValid||!m.isValid,children:a?"Loading ...":"Login"}),r&&Object(d.jsx)("div",{className:"alert alert-danger text-center my-2",children:"Invalid email or password"})]})]})})})},E=a(38),C=a(129),T=a(131),I=a.p+"static/media/defaultImg.11e9da86.jpg",P=function(e){var t=e.post,a=e.onShow,r=e.userProfile,c=e.onDelete,n=(e.modalBtn,Object(s.useContext)(j).user);return Object(d.jsxs)(C.a,{className:"mb-4 mx-4 mx-lg-0",children:[Object(d.jsx)(m.b,{to:"/posts/".concat(t._id),children:Object(d.jsx)(C.a.Img,{variant:"top",src:t.postImg?"https://azstorageabdelrazek.blob.core.windows.net/postimgs/".concat(t.postImg):I})}),Object(d.jsxs)(C.a.Body,{children:[Object(d.jsxs)("div",{className:"px-1 text-center",children:[Object(d.jsx)(C.a.Title,{children:t.title}),Object(d.jsx)(C.a.Text,{children:function(){if(t.body.length<150)return t.body;var e=t.body.substr(0,150);return e=e.substr(0,Math.min(e.length,e.lastIndexOf(" "))),"".concat(e," . . .")}()})]}),Object(d.jsxs)(T.a,{variant:"flush",children:[Object(d.jsx)(T.a.Item,{children:n&&n._id===t.createdBy._id?Object(d.jsx)(m.b,{className:"username-link",to:"/edit-profile",children:t.createdBy?t.createdBy.username:"user"}):Object(d.jsx)(m.b,{className:"username-link",to:{pathname:"/profile/".concat(t.createdBy._id),state:{username:t.createdBy.username}},children:t.createdBy?t.createdBy.username:"user"})}),Object(d.jsx)(T.a.Item,{children:new Date(t.createdAt).toDateString()}),Object(d.jsxs)(T.a.Item,{children:[Object(d.jsx)(m.b,{className:"btn btn-primary",style:{marginRight:"5px"},to:"/posts/".concat(t._id),children:"Open Post"}),!r&&Object(d.jsx)(S.a,{variant:"primary",onClick:function(){return a(t)},children:"Open Modal"}),r&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.b,{className:"btn btn-primary",to:{pathname:"/edit-post/".concat(t._id),state:{postTitle:t.title,postBody:t.body,postImg:t.postImg}},style:{marginRight:"5px"},children:"Edit Post"}),Object(d.jsx)(S.a,{variant:"danger",onClick:function(){return c(t)},children:"Delete Post"})]})]})]})]})]})},L=a(126),B=function(e){var t=e.showModal,a=e.hideModal,s=e.modalData;return Object(d.jsxs)(L.a,{show:t,size:"lg",centered:!0,onHide:a,children:[Object(d.jsx)(L.a.Header,{closeButton:!0,children:Object(d.jsx)(L.a.Title,{id:"contained-modal-title-vcenter",children:s.title})}),Object(d.jsx)(L.a.Body,{children:Object(d.jsx)("p",{children:s.body})}),Object(d.jsx)(L.a.Footer,{children:Object(d.jsx)(S.a,{onClick:a,children:"Close"})})]})},U=function(){var e=Object(s.useState)([]),t=Object(o.a)(e,2),a=t[0],r=t[1],c=Object(s.useState)({}),n=Object(o.a)(c,2),l=n[0],u=n[1],j=Object(s.useState)(!1),b=Object(o.a)(j,2),m=b[0],p=b[1],g=Object(h.g)(),f=Object(h.h)().id,k=g.state.username;Object(s.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.get("/api/v1/posts?userId=".concat(f));case 3:t=e.sent,r(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[f]);return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(E.a,{title:"".concat(k)}),Object(d.jsxs)(y.a,{children:[Object(d.jsxs)("h2",{id:"posts",className:"h3 border-bottom mb-4 pb-4 text-primary",children:[k," posts"]}),Object(d.jsx)(B,{showModal:m,hideModal:function(){p(!1)},modalData:l}),Object(d.jsx)(w.a,{className:"justify-content-center g-4",children:a.length>0?a.map((function(e){return Object(d.jsx)(N.a,{md:6,lg:4,children:Object(d.jsx)(P,{post:e,onShow:function(){return function(e){p(!0),u(e)}(e)}})},e._id)})):Object(d.jsx)(i.a,{animation:"border",role:"status"})})]})]})},_=function(){var e=Object(s.useState)({touched:!1,isValid:!1,msg:""}),t=Object(o.a)(e,2),a=t[0],r=t[1],c=Object(s.useState)({touched:!1,isValid:!1,msg:""}),n=Object(o.a)(c,2),i=n[0],l=n[1],u=Object(s.useState)({touched:!1,isValid:!1,msg:""}),j=Object(o.a)(u,2),b=j[0],m=j[1],h=Object(s.useState)({isError:!1,msg:""}),p=Object(o.a)(h,2),f=p[0],V=p[1],E=Object(s.useState)(!1),C=Object(o.a)(E,2),T=C[0],I=C[1],P=function(){var e=Object(x.a)(O.a.mark((function e(t){var s,r,c;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),I(!0),V({isError:!1,msg:""}),s=t.target.username.value,r=t.target.email.value,c=t.target.password.value,e.prev=4,!(a.isValid&&i.isValid&&b.isValid)){e.next=10;break}return e.next=8,v.a.post("/api/v1/users",{username:s,email:r,password:c});case 8:e.sent.data&&(window.location.replace("/app/login"),I(!1));case 10:e.next=16;break;case 12:e.prev=12,e.t0=e.catch(4),I(!1),409===e.t0.response.status?V({isError:!0,msg:"Email is already used"}):V({isError:!0,msg:"Somthing went wrong!"});case 16:case"end":return e.stop()}}),e,null,[[4,12]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsx)(y.a,{children:Object(d.jsx)(w.a,{children:Object(d.jsxs)(N.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[Object(d.jsx)("h2",{className:" text-center h4 m-3 text-secondary",children:"Register"}),Object(d.jsxs)(k.a,{onSubmit:P,children:[Object(d.jsxs)(k.a.Group,{className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Username"}),Object(d.jsx)(k.a.Control,{type:"text",placeholder:"Enter username",name:"username",onBlur:function(e){var t=e.target.value.trim(),s=Object(g.a)({},a);s.touched=!0,t.length<=0?(s.isValid=!1,s.msg="Username is required."):t.length<3?(s.isValid=!1,s.msg="Username must be more than 2 characters."):t.length>100?(s.isValid=!1,s.msg="Username must be less than 100 characters."):(s.isValid=!0,s.msg=""),r(Object(g.a)({},s))},className:function(){if(a.touched)return a.isValid?"border border-success":"border border-danger"}()}),a.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:a.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"exampleForm.ControlInput1",children:[Object(d.jsx)(k.a.Label,{children:"Email address"}),Object(d.jsx)(k.a.Control,{type:"email",placeholder:"Enter email",name:"email",onBlur:function(e){var t=e.target.value.trim(),a=Object(g.a)({},i);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Email is required."):/\S+@\S+\.\S+/.test(t)?t.length>100?(a.isValid=!1,a.msg="Email must be less than 100 characters."):(a.isValid=!0,a.msg=""):(a.isValid=!1,a.msg="Email is not valid"),l(Object(g.a)({},a))},className:function(){if(i.touched)return i.isValid?"border border-success":"border border-danger"}()}),i.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:i.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"formPlaintextPassword1",children:[Object(d.jsx)(k.a.Label,{children:"Password"}),Object(d.jsx)(k.a.Control,{type:"password",placeholder:"Enter password",name:"password",onKeyUp:function(e){var t=e.target.value.trim(),a=Object(g.a)({},b);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Password is required."):t.length<4?(a.isValid=!1,a.msg="Password must be more than 3 characters."):t.length>255?(a.isValid=!1,a.msg="Password must be less than 255 characters."):(a.isValid=!0,a.msg=""),m(Object(g.a)({},a))},className:function(){if(b.touched)return b.isValid?"border border-success":"border border-danger"}()}),b.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:b.msg})]}),Object(d.jsx)(S.a,{variant:"primary",type:"submit",className:"w-100",disabled:!a.isValid||!i.isValid||!b.isValid,children:T?"Loading ...":"Register"}),f.isError&&Object(d.jsx)("div",{className:"alert alert-danger text-center my-2",children:f.msg})]})]})})})},F=a(31),G=a(124),D=function(){var e=Object(s.useContext)(j),t=e.user,a=e.dispatch,r=Object(s.useState)(t.username),c=Object(o.a)(r,2),n=c[0],i=c[1],l=Object(s.useState)(t.email),u=Object(o.a)(l,2),b=u[0],h=u[1],p=Object(s.useState)({touched:!1,isValid:!0,msg:""}),f=Object(o.a)(p,2),V=f[0],E=f[1],C=Object(s.useState)({touched:!1,isValid:!0,msg:""}),T=Object(o.a)(C,2),I=T[0],L=T[1],B=Object(s.useState)([]),U=Object(o.a)(B,2),_=U[0],D=U[1],q=Object(s.useState)(!1),R=Object(o.a)(q,2),A=R[0],M=R[1],z=Object(s.useState)(!1),H=Object(o.a)(z,2),J=H[0],W=H[1],K=Object(s.useState)(!1),Y=Object(o.a)(K,2),Q=Y[0],X=Y[1],Z=Object(s.useState)(!1),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ae=Object(s.useState)({isError:!1,isSuccess:!1}),se=Object(o.a)(ae,2),re=se[0],ce=se[1],ne=Object(s.useState)({isError:!1,msg:""}),ie=Object(o.a)(ne,2),oe=ie[0],le=ie[1];Object(s.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(){var a;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.get("/api/v1/posts?userId=".concat(t._id));case 3:a=e.sent,D(a.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[Q,t._id,ee]);var de=function(){var e=Object(x.a)(O.a.mark((function e(){var s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.post("/api/v1/users/refresh-token",{token:t.refreshToken});case 3:return s=e.sent,a({type:"LOGIN_SUCCESS",payload:Object(g.a)(Object(g.a)({},t),{},{accessToken:s.data.accessToken})}),e.abrupt("return",s.data);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),ue=v.a.create(),je=Object(F.a)(t.accessToken);ue.interceptors.request.use(function(){var e=Object(x.a)(O.a.mark((function e(t){var a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new Date,!(1e3*je.exp<a.getTime())){e.next=6;break}return e.next=4,de();case 4:s=e.sent,t.headers["auth-token"]=s.accessToken;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}));var be=function(){var e=Object(x.a)(O.a.mark((function e(a){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ue.delete("/api/v1/posts/".concat(a._id),{headers:{"auth-token":t.accessToken}});case 3:e.sent&&(X(!Q),ce({isError:!1,isSuccess:!0})),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),ce({isError:!0,isSuccess:!1});case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),me=function(){var e=Object(x.a)(O.a.mark((function e(s){var r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s.preventDefault(),e.prev=1,M(!0),le({isError:!1,msg:""}),!V.isValid||!I.isValid){e.next=9;break}return e.next=7,ue.put("/api/v1/users/".concat(t._id),{username:n,email:b},{headers:{"auth-token":t.accessToken}});case 7:(r=e.sent)&&(a({type:"LOGIN_SUCCESS",payload:Object(g.a)(Object(g.a)({},t),{},{username:r.data.username,email:r.data.email})}),M(!1),te(!0));case 9:e.next=16;break;case 11:e.prev=11,e.t0=e.catch(1),te(!1),M(!1),409===e.t0.response.status?le({isError:!0,msg:"Email is already used"}):le({isError:!0,msg:"Somthing went wrong!"});case 16:case"end":return e.stop()}}),e,null,[[1,11]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsxs)(y.a,{children:[re.isError&&Object(d.jsx)(G.a,{variant:"danger",onClose:function(){return ce({isError:!1,isSuccess:!1})},className:"success-alert",dismissible:!0,children:Object(d.jsx)(G.a.Heading,{className:"f-1",children:"Somthing went wrong!"})}),re.isSuccess&&Object(d.jsx)(G.a,{variant:"success",onClose:function(){return ce({isError:!1,isSuccess:!1})},className:"success-alert",dismissible:!0,children:Object(d.jsx)(G.a.Heading,{className:"f-1",children:"Post has been successfully deleted"})}),Object(d.jsx)(w.a,{children:Object(d.jsxs)(N.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[!J&&Object(d.jsx)("div",{style:{textAlign:"center"},children:Object(d.jsx)(S.a,{variant:"primary",className:"w-50",onClick:function(){return W(!0)},children:"Update Profile"})}),J&&Object(d.jsxs)(k.a,{onSubmit:me,children:[Object(d.jsxs)(k.a.Group,{className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Username"}),Object(d.jsx)(k.a.Control,{type:"text",placeholder:"Enter username",name:"username",value:n,onChange:function(e){var t=e.target.value;i(t);var a=Object(g.a)({},V);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Username is required."):t.length<4?(a.isValid=!1,a.msg="Username must be more than 3 characters."):t.length>100?(a.isValid=!1,a.msg="Username must be less than 100 characters."):(a.isValid=!0,a.msg=""),E(Object(g.a)({},a))},className:function(){if(V.touched)return V.isValid?"border border-success":"border border-danger"}()}),V.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:V.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"exampleForm.ControlInput1",children:[Object(d.jsx)(k.a.Label,{children:"Email address"}),Object(d.jsx)(k.a.Control,{type:"email",placeholder:"Enter email",name:"email",value:b,onChange:function(e){var t=e.target.value;h(t);var a=Object(g.a)({},I);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Email is required."):!function(e){return/\S+@\S+\.\S+/.test(e)}(t)?(a.isValid=!1,a.msg="Email is not valid"):t.length>100?(a.isValid=!1,a.msg="Email must be less than 100 characters."):(a.isValid=!0,a.msg=""),L(Object(g.a)({},a))},className:function(){if(I.touched)return I.isValid?"border border-success":"border border-danger"}()}),I.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:I.msg})]}),Object(d.jsx)(S.a,{variant:"primary",type:"submit",className:"w-100",disabled:!V.isValid||!I.isValid,children:A?"Loading ...":"Update"}),ee&&Object(d.jsx)("div",{className:"alert alert-success text-center my-2",children:"Update Successfully"}),oe.isError&&Object(d.jsx)("div",{className:"alert alert-danger text-center my-2",children:oe.msg})]})]})}),Object(d.jsx)("h2",{id:"posts",className:"h3 border-bottom mb-4 pb-4 text-primary",children:"Your Posts"}),Object(d.jsx)(w.a,{className:"justify-content-center g-4",children:_.length>0?_.map((function(e){return Object(d.jsx)(N.a,{md:6,lg:4,children:Object(d.jsx)(P,{post:e,userProfile:!0,onDelete:be})},e._id)})):Object(d.jsxs)("h5",{className:"my-4",children:["You do not have any posts, ",Object(d.jsx)(m.b,{to:"/add-post",children:"Write now"})]})})]})},q=function(){var e=Object(s.useState)([]),t=Object(o.a)(e,2),a=t[0],r=t[1],c=Object(s.useState)({}),n=Object(o.a)(c,2),l=n[0],u=n[1],j=Object(s.useState)(!1),b=Object(o.a)(j,2),m=b[0],h=b[1];Object(s.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.get("/api/v1/posts");case 3:(t=e.sent)&&r(t.data),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}})()()}),[]);return Object(d.jsxs)(y.a,{children:[Object(d.jsx)("h2",{id:"posts",className:"h3 border-bottom mb-4 pb-4 text-primary",children:"Posts"}),Object(d.jsx)(B,{showModal:m,hideModal:function(){h(!1)},modalData:l}),Object(d.jsx)(w.a,{className:"justify-content-center g-4",children:a.length>0?a.map((function(e){return Object(d.jsx)(N.a,{md:6,lg:4,children:Object(d.jsx)(P,{post:e,onShow:function(){return function(e){h(!0),u(e)}(e)}})},e._id)})):Object(d.jsx)(i.a,{className:"my-4",animation:"border",role:"status"})})]})},R=function(){var e=Object(s.useContext)(j).user;return Object(d.jsxs)("div",{children:[Object(d.jsx)(E.a,{title:e&&"Welcome ".concat(e.username,", to our blog")}),Object(d.jsx)(q,{})]})},A=a(41),M=a(42),z=a(60),H=a(58),J=function(e){Object(z.a)(a,e);var t=Object(H.a)(a);function a(){return Object(A.a)(this,a),t.apply(this,arguments)}return Object(M.a)(a,[{key:"componentDidMount",value:function(){this.props.history.replace("/not-found")}},{key:"render",value:function(){return Object(d.jsx)("div",{children:Object(d.jsx)(E.a,{title:"404 not found"})})}}]),a}(r.a.Component),W=a(125),K=function(e){var t=Object(s.useContext)(j),a=t.user,r=t.dispatch,c=Object(s.useState)(null),n=Object(o.a)(c,2),i=n[0],l=n[1],u=Object(s.useState)(!1),b=Object(o.a)(u,2),m=b[0],h=b[1],p=Object(s.useState)(!1),f=Object(o.a)(p,2),V=f[0],E=f[1],C=Object(s.useState)({touched:!1,isValid:!1,msg:""}),T=Object(o.a)(C,2),I=T[0],P=T[1],L=Object(s.useState)({touched:!1,isValid:!1,msg:""}),B=Object(o.a)(L,2),U=B[0],_=B[1],G=Object(s.useState)({isError:!1,msg:""}),D=Object(o.a)(G,2),q=D[0],R=D[1],A=function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.post("/api/v1/users/refresh-token",{token:a.refreshToken});case 3:return t=e.sent,r({type:"LOGIN_SUCCESS",payload:Object(g.a)(Object(g.a)({},a),{},{accessToken:t.data.accessToken})}),e.abrupt("return",t.data);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),M=v.a.create();M.interceptors.request.use(function(){var e=Object(x.a)(O.a.mark((function e(t){var s,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new Date,!(1e3*Object(F.a)(a.accessToken).exp<s.getTime())){e.next=7;break}return e.next=5,A();case 5:r=e.sent,t.headers["auth-token"]=r.accessToken;case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}));var z=function(){var e=Object(x.a)(O.a.mark((function e(t){var s,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),e.prev=1,!(I.isValid&&U.isValid&&i)){e.next=12;break}return(s=new FormData).append("title",t.target.title.value),s.append("body",t.target.body.value),s.append("image",i),h(!0),e.next=10,M({method:"post",url:"/api/v1/posts",data:s,headers:{"auth-token":a.accessToken,"Content-Type":"multipart/form-data"}});case 10:(r=e.sent).data&&(h(!1),E(!0),window.location.replace("/app/posts/".concat(r.data._id)),t.target.reset());case 12:e.next=19;break;case 14:e.prev=14,e.t0=e.catch(1),h(!1),E(!1),400===e.t0.response.status?R({isError:!0,msg:"Invalid inputs"}):R({isError:!0,msg:"Somthing went wrong!"});case 19:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsx)(y.a,{children:Object(d.jsx)(w.a,{children:Object(d.jsxs)(N.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[Object(d.jsx)("h2",{className:" text-center h4 m-3 text-secondary",children:"Add Post"}),Object(d.jsxs)(k.a,{onSubmit:z,children:[Object(d.jsxs)(k.a.Group,{className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Post title"}),Object(d.jsx)(k.a.Control,{type:"text",placeholder:"Enter Title",name:"title",className:function(){if(I.touched)return I.isValid?"border border-success":"border border-danger"}(),onBlur:function(e){var t=e.target.value.trim(),a=Object(g.a)({},I);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Title is required."):t.length<3?(a.isValid=!1,a.msg="Title must be more than 2 characters."):t.length>255?(a.isValid=!1,a.msg="Title must be less than 255 characters."):(a.isValid=!0,a.msg=""),P(Object(g.a)({},a))},autoFocus:!0}),I.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:I.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"exampleForm.ControlTextarea1",children:[Object(d.jsx)(k.a.Label,{children:"Post body"}),Object(d.jsx)(k.a.Control,{as:"textarea",rows:3,name:"body",className:function(){if(U.touched)return U.isValid?"border border-success":"border border-danger"}(),onChange:function(e){var t=e.target.value.trim(),a=Object(g.a)({},U);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Body is required."):t.length<5?(a.isValid=!1,a.msg="Body must be more than 4 characters."):t.length>1e4?(a.isValid=!1,a.msg="Body must be less than 10000 characters."):(a.isValid=!0,a.msg=""),_(Object(g.a)({},a))}}),U.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:U.msg})]}),Object(d.jsxs)(k.a.Group,{controlId:"formFile",className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Post image"}),Object(d.jsx)("div",{className:"d-flex my-2 justify-content-center",children:Object(d.jsx)(N.a,{xs:6,md:4,children:i&&Object(d.jsx)(W.a,{src:URL.createObjectURL(i),thumbnail:!0})})}),Object(d.jsx)(k.a.Control,{type:"file",name:"image",accept:"image/png, image/jpeg, image/jpg, image/JPG, image/svg, image/webp",onChange:function(e){return l(e.target.files[0])}})]}),Object(d.jsx)(S.a,{variant:"primary",type:"submit",className:"w-100",disabled:!I.isValid||!U.isValid||!i,children:m?"Loading ...":"Add New Post"})]}),q.isError&&Object(d.jsx)("div",{className:"alert alert-danger text-center my-2",children:q.msg}),V&&Object(d.jsx)("div",{className:"alert alert-success text-center my-2",children:"Post Added Successfully"})]})})})},Y=a(128),Q=a(130),X=function(){var e=Object(s.useContext)(j),t=e.user,a=e.dispatch,r=function(){var e=Object(x.a)(O.a.mark((function e(){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.post("/api/v1/users/logout",{token:t.refreshToken});case 3:e.sent&&(a({type:"LOGOUT"}),window.location.replace("/app")),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),window.location.replace("/app");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)(Y.a,{collapseOnSelect:!0,expand:"lg",bg:"dark",variant:"dark",sticky:"top",children:Object(d.jsxs)(y.a,{children:[Object(d.jsx)(Y.a.Brand,{children:Object(d.jsx)(m.b,{className:"white-link",to:"/",children:"Mern Blog"})}),Object(d.jsx)(Y.a.Toggle,{"aria-controls":"responsive-navbar-nav"}),Object(d.jsx)(Y.a.Collapse,{id:"responsive-navbar-nav",className:"justify-content-end",children:Object(d.jsxs)(Q.a,{className:"",children:[Object(d.jsx)(m.c,{className:"nav-link",exact:!0,to:"/",children:"home"}),t?null:Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.c,{className:"nav-link",to:"/login",children:"login"}),Object(d.jsx)(m.c,{className:"nav-link",to:"/register",children:"register"})]}),t?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(m.c,{className:"nav-link",to:"/add-post",children:"write"}),Object(d.jsx)(m.c,{className:"nav-link",to:"/edit-profile",children:"profile"}),Object(d.jsx)("span",{className:"nav-link",style:{cursor:"pointer"},onClick:r,children:"logout"})]}):null,Object(d.jsx)(m.c,{className:"nav-link",to:"/about",children:"contact"})]})})]})})},Z=function(){return Object(d.jsx)("footer",{className:"d-flex justify-content-center p-4 bg-light",children:Object(d.jsx)("h4",{className:"lead text-secondary",children:" \xa9 2021 Abdelrazek"})})},$=function(){var e=Object(s.useContext)(j),t=e.user,a=e.dispatch,r=Object(h.h)().id,c=Object(h.g)().state,n=c.postTitle,i=c.postBody,l=c.postImg,u=Object(s.useState)(n),b=Object(o.a)(u,2),m=b[0],p=b[1],f=Object(s.useState)(i),V=Object(o.a)(f,2),E=V[0],C=V[1],T=Object(s.useState)(null),I=Object(o.a)(T,2),P=I[0],L=I[1],B=Object(s.useState)(!1),U=Object(o.a)(B,2),_=U[0],G=U[1],D=Object(s.useState)(!1),q=Object(o.a)(D,2),R=q[0],A=q[1],M=Object(s.useState)({touched:!1,isValid:!0,msg:""}),z=Object(o.a)(M,2),H=z[0],J=z[1],K=Object(s.useState)({touched:!1,isValid:!0,msg:""}),Y=Object(o.a)(K,2),Q=Y[0],X=Y[1],Z=Object(s.useState)({isError:!1,msg:""}),$=Object(o.a)(Z,2),ee=$[0],te=$[1],ae=function(){var e=Object(x.a)(O.a.mark((function e(){var s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.post("/api/v1/users/refresh-token",{token:t.refreshToken});case 3:return s=e.sent,a({type:"LOGIN_SUCCESS",payload:Object(g.a)(Object(g.a)({},t),{},{accessToken:s.data.accessToken})}),e.abrupt("return",s.data);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),se=v.a.create();se.interceptors.request.use(function(){var e=Object(x.a)(O.a.mark((function e(a){var s,r;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=new Date,!(1e3*Object(F.a)(t.accessToken).exp<s.getTime())){e.next=7;break}return e.next=5,ae();case 5:r=e.sent,a.headers["auth-token"]=r.accessToken;case 7:return e.abrupt("return",a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}));var re=function(){var e=Object(x.a)(O.a.mark((function e(a){var s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a.preventDefault(),e.prev=1,!H.isValid||!Q.isValid){e.next=12;break}return(s=new FormData).append("title",m),s.append("body",E),P&&s.append("image",P),G(!0),e.next=10,se({method:"put",url:"/api/v1/posts/".concat(r),data:s,headers:{"auth-token":t.accessToken,"Content-Type":"multipart/form-data"}});case 10:e.sent.data&&(G(!1),A(!0));case 12:e.next=20;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0),G(!1),A(!1),400===e.t0.response.status?te({isError:!0,msg:"Invalid inputs"}):te({isError:!0,msg:"Somthing went wrong!"});case 20:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}();return Object(d.jsx)(y.a,{children:Object(d.jsx)(w.a,{children:Object(d.jsxs)(N.a,{md:6,lg:4,className:" mx-auto bg-light p-4 my-4 shadow-sm",children:[Object(d.jsx)("h2",{className:" text-center h4 m-3 text-secondary",children:"Update Post"}),Object(d.jsxs)(k.a,{onSubmit:re,children:[Object(d.jsxs)(k.a.Group,{className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Post title"}),Object(d.jsx)(k.a.Control,{type:"text",value:m,name:"title",className:function(){if(H.touched)return H.isValid?"border border-success":"border border-danger"}(),onChange:function(e){var t=e.target.value;p(t);var a=Object(g.a)({},H);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Title is required."):t.length<3?(a.isValid=!1,a.msg="Title must be more than 2 characters."):t.length>255?(a.isValid=!1,a.msg="Title must be less than 255 characters."):(a.isValid=!0,a.msg=""),J(Object(g.a)({},a))}}),H.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:H.msg})]}),Object(d.jsxs)(k.a.Group,{className:"mb-3",controlId:"exampleForm.ControlTextarea1",children:[Object(d.jsx)(k.a.Label,{children:"Post body"}),Object(d.jsx)(k.a.Control,{as:"textarea",value:E,rows:3,name:"body",className:function(){if(Q.touched)return Q.isValid?"border border-success":"border border-danger"}(),onChange:function(e){var t=e.target.value;C(t);var a=Object(g.a)({},Q);a.touched=!0,t.length<=0?(a.isValid=!1,a.msg="Body is required."):t.length<5?(a.isValid=!1,a.msg="Body must be more than 4 characters."):t.length>1e4?(a.isValid=!1,a.msg="Body must be less than 10000 characters."):(a.isValid=!0,a.msg=""),X(Object(g.a)({},a))}}),Q.msg&&Object(d.jsx)("small",{className:"text-danger p-1",children:Q.msg})]}),Object(d.jsxs)(k.a.Group,{controlId:"formFile",className:"mb-3",children:[Object(d.jsx)(k.a.Label,{children:"Post image"}),Object(d.jsx)("div",{className:"d-flex my-2 justify-content-center",children:Object(d.jsx)(N.a,{xs:6,md:4,children:P?Object(d.jsx)(W.a,{src:URL.createObjectURL(P),thumbnail:!0}):Object(d.jsx)(W.a,{src:"https://azstorageabdelrazek.blob.core.windows.net/postimgs/".concat(l),thumbnail:!0})})}),Object(d.jsx)(k.a.Control,{type:"file",name:"image",accept:"image/png, image/jpeg, image/jpg, image/JPG, image/svg, image/webp",onChange:function(e){return L(e.target.files[0])}})]}),Object(d.jsx)(S.a,{variant:"primary",type:"submit",className:"w-100",disabled:!H.isValid||!Q.isValid,children:_?"Loading ...":"Update Post"})]}),ee.isError&&Object(d.jsx)("div",{className:"alert alert-danger text-center my-2",children:ee.msg}),R&&Object(d.jsx)("div",{className:"alert alert-success text-center my-2",children:"Post Updated Successfully"})]})})})},ee=function(e){var t=Object(s.useContext)(j),a=t.user,r=t.dispatch,c=Object(h.h)().id,n=Object(s.useState)(null),l=Object(o.a)(n,2),u=l[0],b=l[1],p=Object(s.useState)({isError:!1,isSuccess:!1}),f=Object(o.a)(p,2),w=f[0],N=f[1];Object(s.useEffect)((function(){(function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.a.get("/api/v1/posts/".concat(c));case 2:t=e.sent,b(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()()}),[c]);var k=v.a.create();if(a){var V=function(){var e=Object(x.a)(O.a.mark((function e(){var t;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.post("/api/v1/users/refresh-token",{token:a.refreshToken});case 3:return t=e.sent,r({type:"LOGIN_SUCCESS",payload:Object(g.a)(Object(g.a)({},a),{},{accessToken:t.data.accessToken})}),e.abrupt("return",t.data);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(){return e.apply(this,arguments)}}(),E=Object(F.a)(a.accessToken);k.interceptors.request.use(function(){var e=Object(x.a)(O.a.mark((function e(t){var a,s;return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=new Date,!(1e3*E.exp<a.getTime())){e.next=6;break}return e.next=4,V();case 4:s=e.sent,t.headers["auth-token"]=s.accessToken;case 6:return e.abrupt("return",t);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),(function(e){return Promise.reject(e)}))}var P=function(){var e=Object(x.a)(O.a.mark((function e(t){return O.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,k.delete("/api/v1/posts/".concat(t),{headers:{"auth-token":a.accessToken}});case 3:e.sent&&(N({isError:!1,isSuccess:!0}),setTimeout(window.location.replace("/app"),3e3)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),N({isError:!0,isSuccess:!1});case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();return u?Object(d.jsxs)(y.a,{children:[w.isError&&Object(d.jsx)(G.a,{variant:"danger",onClose:function(){return N({isError:!1,isSuccess:!1})},className:"success-alert",dismissible:!0,children:Object(d.jsx)(G.a.Heading,{className:"f-1",children:"Somthing went wrong!"})}),w.isSuccess&&Object(d.jsx)(G.a,{variant:"success",onClose:function(){return N({isError:!1,isSuccess:!1})},className:"success-alert",dismissible:!0,children:Object(d.jsx)(G.a.Heading,{className:"f-1",children:"Post has been successfully deleted"})}),Object(d.jsxs)(C.a,{className:"my-4",children:[Object(d.jsx)("div",{style:{textAlign:"center"},children:Object(d.jsx)(C.a.Img,{className:"w-50 my-2",src:u.postImg?"https://azstorageabdelrazek.blob.core.windows.net/postimgs/".concat(u.postImg):I})}),Object(d.jsxs)(C.a.Body,{children:[Object(d.jsxs)("div",{className:"px-1 text-center",children:[Object(d.jsx)(C.a.Title,{children:u.title}),Object(d.jsx)(C.a.Text,{className:"first-letter",style:{lineHeight:2},children:u.body})]}),Object(d.jsxs)(T.a,{variant:"flush",children:[Object(d.jsx)(T.a.Item,{children:a&&a._id===u.createdBy._id?Object(d.jsx)(m.b,{className:"username-link",to:"/edit-profile",children:u.createdBy?u.createdBy.username:"user"}):Object(d.jsx)(m.b,{className:"username-link",to:{pathname:"/profile/".concat(u.createdBy._id),state:{username:u.createdBy.username}},children:u.createdBy?u.createdBy.username:"user"})}),Object(d.jsx)(T.a.Item,{children:new Date(u.createdAt).toDateString()}),a&&a._id===u.createdBy._id?Object(d.jsxs)(T.a.Item,{children:[Object(d.jsx)(m.b,{className:"btn btn-primary",to:{pathname:"/edit-post/".concat(u._id),state:{postTitle:u.title,postBody:u.body,postImg:u.postImg}},style:{marginRight:"5px"},children:"Edit Post"}),Object(d.jsx)(S.a,{variant:"danger",onClick:function(){return P(c)},children:"Delete Post"})]}):null]})]})]})]}):Object(d.jsx)("div",{className:"d-flex justify-content-center m-4",children:Object(d.jsx)(i.a,{animation:"border",role:"status"})})},te=r.a.lazy((function(){return Promise.all([a.e(4),a.e(3)]).then(a.bind(null,133))})),ae=function(){var e=Object(s.useContext)(j).user;return Object(d.jsx)(d.Fragment,{children:Object(d.jsxs)(m.a,{basename:"/app",children:[Object(d.jsx)(X,{}),Object(d.jsxs)(h.d,{children:[Object(d.jsx)(h.b,{path:"/",exact:!0,component:R}),Object(d.jsx)(h.b,{path:"/login",component:V}),Object(d.jsx)(h.b,{path:"/register",component:_}),Object(d.jsx)(h.b,{path:"/profile/:id",component:U}),Object(d.jsx)(h.b,{path:"/posts/:id",component:ee}),Object(d.jsx)(h.b,{path:"/about",render:function(){return Object(d.jsx)(s.Suspense,{fallback:Object(d.jsx)("div",{className:"d-flex justify-content-center",children:Object(d.jsx)(i.a,{className:"my-4",animation:"border",role:"status"})}),children:Object(d.jsx)(te,{})})}}),e?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(h.b,{path:"/edit-profile",component:D}),Object(d.jsx)(h.b,{path:"/add-post",component:K}),Object(d.jsx)(h.b,{path:"/edit-post/:id",component:$})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(h.a,{from:"/edit-profile",to:"/login"}),Object(d.jsx)(h.a,{from:"/add-post",to:"/login"}),Object(d.jsx)(h.a,{from:"/edit-post/:id",to:"/login"})]}),Object(d.jsx)(h.a,{from:"/home",to:"/"}),Object(d.jsx)(h.b,{component:J})]}),Object(d.jsx)(Z,{})]})})};n.a.render(Object(d.jsx)(r.a.StrictMode,{children:Object(d.jsx)(b,{children:Object(d.jsx)(ae,{})})}),document.getElementById("root"))},38:function(e,t,a){"use strict";var s=a(0);t.a=function(e){var t=e.title;return Object(s.jsx)("div",{className:"head d-flex justify-content-center align-items-center",children:Object(s.jsx)("div",{className:"d-flex justify-content-center",children:Object(s.jsx)("h1",{className:"text-white display-2 mx-1",children:t||"Welcome to Our Blog"})})})}},87:function(e,t,a){}},[[118,1,2]]]);
//# sourceMappingURL=main.e697398c.chunk.js.map